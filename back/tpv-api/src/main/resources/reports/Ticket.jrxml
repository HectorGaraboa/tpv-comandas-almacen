<!-- Created with Jaspersoft Studio version 7.0.3.final using JasperReports Library version 7.0.3-41034ca841d452f3305ba55b9042260aaa1ab5dd  -->
<jasperReport name="Ticket" language="java" columnCount="1" pageWidth="180" pageHeight="600" orientation="Landscape" columnWidth="170" leftMargin="5" rightMargin="5" topMargin="5" bottomMargin="5" uuid="14a52ef0-ceb3-42c9-8cf5-b73f6a99fc06">
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="pixel"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="TPV_BD"/>
	<parameter name="TICKET_ID" class="java.lang.Long"/>
	<query language="sql"><![CDATA[SELECT
    t.id                      AS ticket_id,
    t.creado_at               AS fecha,
    t.metodo_pago             AS metodo_pago,
    t.total                   AS total,
    t.base_total              AS base_total,
    t.iva_total               AS iva_total,
    
    m.codigo                  AS mesa_codigo,
    
    p.nombre                  AS producto_nombre,
    cl.cantidad               AS cantidad,
    cl.precio_unitario        AS precio_unitario,
    cl.iva_tipo               AS iva_tipo,
    (cl.cantidad * cl.precio_unitario) AS subtotal
FROM ticket t
JOIN ticket_comanda tc ON tc.ticket_id = t.id
JOIN comanda c         ON c.id = tc.comanda_id
JOIN mesa m            ON m.id = c.mesa_id
JOIN comanda_linea cl  ON cl.comanda_id = c.id AND cl.anulada = 0
JOIN producto p        ON p.id = cl.producto_id
WHERE t.id = $P{TICKET_ID}
ORDER BY cl.id


]]></query>
	<field name="ticket_id" class="java.lang.Long">
		<property name="com.jaspersoft.studio.field.name" value="id"/>
		<property name="com.jaspersoft.studio.field.label" value="ticket_id"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="ticket"/>
	</field>
	<field name="fecha" class="java.time.LocalDateTime">
		<property name="com.jaspersoft.studio.field.name" value="creado_at"/>
		<property name="com.jaspersoft.studio.field.label" value="fecha"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="ticket"/>
	</field>
	<field name="metodo_pago" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="metodo_pago"/>
		<property name="com.jaspersoft.studio.field.label" value="metodo_pago"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="ticket"/>
	</field>
	<field name="total" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="total"/>
		<property name="com.jaspersoft.studio.field.label" value="total"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="ticket"/>
	</field>
	<field name="base_total" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="base_total"/>
		<property name="com.jaspersoft.studio.field.label" value="base_total"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="ticket"/>
	</field>
	<field name="iva_total" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="iva_total"/>
		<property name="com.jaspersoft.studio.field.label" value="iva_total"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="ticket"/>
	</field>
	<field name="mesa_codigo" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="codigo"/>
		<property name="com.jaspersoft.studio.field.label" value="mesa_codigo"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="mesa"/>
	</field>
	<field name="producto_nombre" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="nombre"/>
		<property name="com.jaspersoft.studio.field.label" value="producto_nombre"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="producto"/>
	</field>
	<field name="cantidad" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="cantidad"/>
		<property name="com.jaspersoft.studio.field.label" value="cantidad"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="comanda_linea"/>
	</field>
	<field name="precio_unitario" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="precio_unitario"/>
		<property name="com.jaspersoft.studio.field.label" value="precio_unitario"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="comanda_linea"/>
	</field>
	<field name="iva_tipo" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="iva_tipo"/>
		<property name="com.jaspersoft.studio.field.label" value="iva_tipo"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="comanda_linea"/>
	</field>
	<field name="subtotal" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="subtotal"/>
		<property name="com.jaspersoft.studio.field.label" value="subtotal"/>
	</field>
	<background splitType="Stretch"/>
	<title height="127" splitType="Stretch">
		<element kind="staticText" uuid="3c6853f6-c19e-49d9-bb18-2a8211e3f33a" x="35" y="0" width="100" height="30" hTextAlign="Center" vTextAlign="Middle">
			<text><![CDATA[Nombre Empresa
]]></text>
		</element>
		<element kind="staticText" uuid="0d54d1aa-749a-47f7-beb6-ad857401568c" x="35" y="30" width="100" height="60" hTextAlign="Center">
			<text><![CDATA[Calle Ejemplo 123
Ciudad (00000)
C.I.F.: X00000000
]]></text>
		</element>
		<element kind="staticText" uuid="8970cbad-cb7e-436e-adaf-5f047ac492b7" x="-2" y="97" width="175" height="30" hTextAlign="Center">
			<text><![CDATA[-----------------------------------------
]]></text>
		</element>
		<property name="com.jaspersoft.studio.unit.height" value="px"/>
	</title>
	<pageHeader height="80" splitType="Stretch">
		<element kind="staticText" uuid="eae5e994-793d-4bd9-be20-0038776a4ff2" x="0" y="0" width="40" height="14">
			<text><![CDATA[Ticket:]]></text>
		</element>
		<element kind="textField" uuid="14afd10c-657e-4111-8f82-8823968defbd" x="40" y="0" width="100" height="14">
			<expression><![CDATA[$F{ticket_id}
]]></expression>
		</element>
		<element kind="staticText" uuid="bc2a792e-bff5-45af-9893-5b41ddf9bd04" x="0" y="28" width="40" height="14">
			<text><![CDATA[Fecha:]]></text>
		</element>
		<element kind="textField" uuid="d57bf9cb-a727-4904-aade-6c3e9180688b" x="40" y="14" width="100" height="14">
			<expression><![CDATA[$F{mesa_codigo}

]]></expression>
		</element>
		<element kind="staticText" uuid="0867b8ef-e2c3-49e6-bf7c-5cad6024e651" x="0" y="14" width="40" height="14">
			<text><![CDATA[Mesa:]]></text>
		</element>
		<element kind="textField" uuid="46d8f1e0-92d6-4c77-a768-d7eb29fdb271" x="40" y="28" width="100" height="14">
			<expression><![CDATA[$F{fecha}.toLocalDate().format(java.time.format.DateTimeFormatter.ofPattern("dd/MM/yyyy"))

]]></expression>
		</element>
		<element kind="staticText" uuid="746a456b-04d0-44fb-b600-a4422e7eb127" x="0" y="43" width="40" height="14">
			<text><![CDATA[Hora:]]></text>
		</element>
		<element kind="textField" uuid="40cb3f6c-869e-406a-8322-b14a1b1375f1" x="40" y="43" width="100" height="14">
			<expression><![CDATA[$F{fecha}.toLocalTime().format(java.time.format.DateTimeFormatter.ofPattern("HH:mm"))
]]></expression>
		</element>
		<element kind="staticText" uuid="b6d733e8-e084-4fca-9bc4-1d5edcbc930f" x="0" y="57" width="40" height="14">
			<text><![CDATA[Pago:]]></text>
		</element>
		<element kind="textField" uuid="59f5957d-4293-403b-bc6c-207a566c5a18" x="40" y="57" width="100" height="14">
			<expression><![CDATA[$F{metodo_pago}
]]></expression>
		</element>
	</pageHeader>
	<columnHeader height="31" splitType="Stretch">
		<element kind="staticText" uuid="29e905f9-429c-4eff-973a-5c620a2160ad" x="0" y="0" width="30" height="20" bold="true">
			<text><![CDATA[Unid.]]></text>
		</element>
		<element kind="staticText" uuid="8afc5e2c-79e0-4e64-a3a0-59fb85910deb" x="30" y="0" width="75" height="20" bold="true">
			<text><![CDATA[DescripciÃ³n]]></text>
		</element>
		<element kind="staticText" uuid="72587e76-b7a7-4ef1-ae07-1d04137e0b49" x="105" y="0" width="35" height="20" bold="true">
			<text><![CDATA[Precio]]></text>
		</element>
		<element kind="staticText" uuid="c14fb6c3-86ae-4188-afb0-947dd40aa22f" x="140" y="0" width="30" height="20" bold="true">
			<text><![CDATA[Total]]></text>
		</element>
	</columnHeader>
	<detail>
		<band height="36" splitType="Stretch">
			<element kind="textField" uuid="9e220113-fd68-4cc8-b33f-4923118cc31a" x="0" y="1" width="35" height="17">
				<expression><![CDATA[$F{cantidad}]]></expression>
			</element>
			<element kind="textField" uuid="08c7be2a-8c59-4d7e-af59-d75278a8ac5a" x="35" y="0" width="70" height="30">
				<expression><![CDATA[$F{producto_nombre}
]]></expression>
			</element>
			<element kind="textField" uuid="8ffd0c64-a312-4b54-803e-ea1f82abf052" x="140" y="1" width="30" height="16">
				<expression><![CDATA[$F{subtotal}
]]></expression>
			</element>
			<element kind="textField" uuid="2ce1c465-b824-4feb-825d-524a98613735" x="105" y="0" width="35" height="18">
				<expression><![CDATA[$F{precio_unitario}
]]></expression>
			</element>
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
		</band>
	</detail>
	<columnFooter height="45" splitType="Stretch"/>
	<pageFooter height="54" splitType="Stretch"/>
	<summary height="42" splitType="Stretch"/>
</jasperReport>
